{"version":3,"file":"index.cjs.js","sources":["../node_modules/tslib/tslib.es6.js","../src/hooks.ts","../src/EventEmitter.ts","../src/useRootContext.tsx","../src/ShapeEditor.tsx","../src/DefaultResizeHandleComponent.tsx","../src/utils.ts","../src/wrapShape.tsx","../src/ImageLayer.tsx","../src/DefaultDrawPreviewComponent.tsx","../src/DrawLayer.tsx","../src/DefaultSelectionDrawComponent.tsx","../src/DefaultSelectionComponent.tsx","../src/SelectionLayer.tsx"],"sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","import { useEffect, useRef, useReducer } from 'react';\n\n/**\n * Returns a ref that gets updated with the latest value on every render\n */\nexport const useUpdatingRef = <T>(value: T): React.MutableRefObject<T> => {\n  const ref = useRef(value);\n  ref.current = value;\n  return ref;\n};\n\n/**\n * Returns a ref telling whether the calling component has been mounted or not.\n * Is false for the first render and unmount step.\n */\nexport const useIsMountedRef = (): React.MutableRefObject<boolean> => {\n  const isMountedRef = useRef(false);\n  useEffect(() => {\n    isMountedRef.current = true;\n\n    return () => {\n      isMountedRef.current = false;\n    };\n  }, [isMountedRef]);\n\n  return isMountedRef;\n};\n\n/**\n * Returns a function to force-update a component\n */\nexport const useForceUpdate = () => {\n  const [, forceUpdate] = useReducer((x) => x + 1, 0);\n\n  return forceUpdate as () => void;\n};\n\n/**\n * Triggers a cancel callback when the Escape key is pressed with a mode active\n *\n * @param isActive The mode is active\n * @param cancel Callback to cancel out of the mode\n */\nexport const useCancelModeOnEscapeKey = (\n  isActive: boolean,\n  cancel: () => void\n) => {\n  useEffect(() => {\n    if (!isActive) return undefined;\n\n    const doCancel = (event: KeyboardEvent) => {\n      if (event.key === 'Escape') {\n        event.preventDefault();\n        cancel();\n      }\n    };\n\n    window.addEventListener('keydown', doCancel);\n    return () => {\n      window.removeEventListener('keydown', doCancel);\n    };\n  }, [isActive, cancel]);\n};\n","import React, { useRef, useContext } from 'react';\nimport { ShapeActions, ShapeId } from './types';\nimport { useUpdatingRef } from './hooks';\n\n// eslint-disable-next-line no-shadow\nexport enum EventType {\n  MountedOrUnmounted = 'MountedOrUnmounted',\n  MouseEvent = 'MouseEvent',\n  ChildRectChanged = 'ChildRectChanged',\n  ChildFocus = 'ChildFocus',\n  ChildToggleSelection = 'ChildToggleSelection',\n}\n\ntype MountedOrUnmountedListener = (\n  shapeActionRef: React.MutableRefObject<ShapeActions>,\n  didMount: boolean\n) => void;\ntype MouseEventListener = (event: MouseEvent) => void;\ntype ChildRectChangedListener = (\n  shapeId: ShapeId,\n  isInternalComponent: boolean\n) => void;\ntype ChildFocusListener = (\n  shapeId: ShapeId,\n  isInternalComponent: boolean\n) => void;\ntype ChildToggleSelectionListener = (\n  shapeId: ShapeId,\n  isInternalComponent: boolean,\n  event: React.MouseEvent\n) => void;\n\ntype Listener = (...args: any[]) => void;\ntype CustomListener =\n  | ChildRectChangedListener\n  | ChildFocusListener\n  | MountedOrUnmountedListener\n  | MouseEventListener\n  | ChildToggleSelectionListener;\n\ntype ListenerRef = React.MutableRefObject<Listener>;\n\nexport class EventEmitter {\n  private listeners: { [eventType: string]: ListenerRef[] };\n\n  constructor() {\n    this.listeners = {};\n  }\n\n  addListener(eventType: EventType, fn: ListenerRef): this {\n    this.listeners[eventType] = this.listeners[eventType] || [];\n    this.listeners[eventType].push(fn);\n\n    return this;\n  }\n\n  removeListener(eventType: EventType, fn: ListenerRef): this {\n    const matchingListeners = this.listeners[eventType];\n    if (!matchingListeners) {\n      return this;\n    }\n\n    for (let i = matchingListeners.length; i > 0; i -= 1) {\n      if (matchingListeners[i] === fn) {\n        matchingListeners.splice(i, 1);\n        break;\n      }\n    }\n\n    return this;\n  }\n\n  overwriteAllListenersOfType(eventType: EventType, fn: ListenerRef): this {\n    delete this.listeners[eventType];\n\n    return this.addListener(eventType, fn);\n  }\n\n  emit(eventType: EventType, ...args: any[]): void {\n    const matchingListeners = this.listeners[eventType];\n    if (!matchingListeners) {\n      return;\n    }\n\n    matchingListeners.forEach((f: ListenerRef) => {\n      f.current(...args);\n    });\n  }\n}\n\nexport const useNewEventEmitter = (): EventEmitter => {\n  const emitterRef = useRef(new EventEmitter());\n\n  return emitterRef.current;\n};\n\nexport const useAdditionalListener = (\n  emitter: EventEmitter,\n  eventType: EventType,\n  listener: CustomListener\n): void => {\n  const listenerRef = useUpdatingRef(listener);\n\n  emitter\n    .removeListener(eventType, listenerRef)\n    .addListener(eventType, listenerRef);\n};\n\nconst EventEmitterContext = React.createContext<EventEmitter | undefined>(\n  undefined\n);\nexport const EventEmitterProvider = EventEmitterContext.Provider;\nexport const useEventEmitterContext = (): EventEmitter => {\n  const emitter = useContext(EventEmitterContext);\n  if (emitter === undefined) {\n    throw new Error(\n      'useEventEmitterContext must be used within a EventEmitterProvider'\n    );\n  }\n\n  return emitter;\n};\n","import React, { useContext, useState, useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport { CoordinateGetterType } from './types';\nimport { useEventEmitterContext } from './EventEmitter';\nimport { useIsMountedRef } from './hooks';\n\nconst CoordinateGetterRefContext = React.createContext<\n  CoordinateGetterType | undefined\n>(undefined);\n\ntype DimensionsType = Readonly<{\n  vectorWidth: number;\n  vectorHeight: number;\n  vectorPaddingTop: number;\n  vectorPaddingRight: number;\n  vectorPaddingBottom: number;\n  vectorPaddingLeft: number;\n  scale: number;\n}>;\n\nconst DimensionsContext = React.createContext<DimensionsType | undefined>(\n  undefined\n);\n\ninterface Props {\n  value: DimensionsType;\n  children: any;\n}\nconst dimensionsProviderPropTypes = {\n  value: PropTypes.shape({\n    vectorWidth: PropTypes.number.isRequired,\n    vectorHeight: PropTypes.number.isRequired,\n    vectorPaddingTop: PropTypes.number.isRequired,\n    vectorPaddingRight: PropTypes.number.isRequired,\n    vectorPaddingBottom: PropTypes.number.isRequired,\n    vectorPaddingLeft: PropTypes.number.isRequired,\n    scale: PropTypes.number.isRequired,\n  }).isRequired,\n  children: PropTypes.node.isRequired,\n};\nexport const DimensionsProvider: React.FunctionComponent<Props> = ({\n  children,\n  value: propDims,\n}) => {\n  // Essentially memoizing the dimensions so passing an object doesn't\n  // trigger re-renders on every render of the parent\n  // See: https://reactjs.org/docs/context.html#caveats\n  const [dimensions, setDimensions] = useState(propDims);\n  const isMountedRef = useIsMountedRef();\n  useEffect(() => {\n    // Skip the mount/unmount step because the state\n    // has already been initialized with the propDims\n    if (!isMountedRef.current) {\n      return;\n    }\n\n    setDimensions(propDims);\n  }, [\n    propDims.scale,\n    propDims.vectorWidth,\n    propDims.vectorHeight,\n    propDims.vectorPaddingTop,\n    propDims.vectorPaddingRight,\n    propDims.vectorPaddingBottom,\n    propDims.vectorPaddingLeft,\n  ]);\n\n  return (\n    <DimensionsContext.Provider value={dimensions}>\n      {children}\n    </DimensionsContext.Provider>\n  );\n};\nDimensionsProvider.propTypes = dimensionsProviderPropTypes;\nexport const CoordinateGetterRefProvider = CoordinateGetterRefContext.Provider;\n\nexport { EventEmitterProvider } from './EventEmitter';\n\n/**\n * Access the root context values\n */\nconst useRootContext = () => {\n  const coordinateGetterRef = useContext(CoordinateGetterRefContext);\n  if (coordinateGetterRef === undefined) {\n    throw new Error(\n      'useRootContext must be used within a CoordinateGetterRefProvider'\n    );\n  }\n\n  const dimensions = useContext(DimensionsContext);\n  if (dimensions === undefined) {\n    throw new Error('useRootContext must be used within a DimensionsProvider');\n  }\n\n  return {\n    eventEmitter: useEventEmitterContext(),\n    coordinateGetterRef,\n    dimensions,\n  };\n};\n\nexport default useRootContext;\n","import React, {\n  useEffect,\n  useRef,\n  useImperativeHandle,\n  useLayoutEffect,\n} from 'react';\nimport PropTypes from 'prop-types';\nimport {\n  CoordinateGetterRefProvider,\n  EventEmitterProvider,\n  DimensionsProvider,\n} from './useRootContext';\nimport { useIsMountedRef, useUpdatingRef } from './hooks';\nimport {\n  useNewEventEmitter,\n  useAdditionalListener,\n  EventType,\n  EventEmitter,\n} from './EventEmitter';\nimport {\n  ShapeActions,\n  Rectangle,\n  Point,\n  CoordinateGetterType,\n  ShapeActionRefsArrayRef,\n  ShapeEditorProps,\n} from './types';\n\nconst useMouseEventForwarding = (eventEmitter: EventEmitter) => {\n  useEffect(() => {\n    const onMouseEvent = (event: MouseEvent) => {\n      eventEmitter.emit(EventType.MouseEvent, event);\n    };\n\n    window.addEventListener('mouseup', onMouseEvent);\n    window.addEventListener('mousemove', onMouseEvent);\n\n    return () => {\n      window.removeEventListener('mouseup', onMouseEvent);\n      window.removeEventListener('mousemove', onMouseEvent);\n    };\n  }, [eventEmitter]);\n};\n\nconst useChildAddDeleteHandler = (\n  focusOnAdd: boolean,\n  focusOnDelete: boolean\n) => {\n  const justAddedShapeActionRefsRef: ShapeActionRefsArrayRef = useRef([]);\n  const wrappedShapeActionRefsRef: ShapeActionRefsArrayRef = useRef([]);\n  const lastDeletedRectRef = useRef(null as Rectangle | null);\n\n  useLayoutEffect(() => {\n    if (justAddedShapeActionRefsRef.current.length > 0 && focusOnAdd) {\n      // Focus on shapes added since the last update\n      justAddedShapeActionRefsRef.current.slice(-1)[0].current.forceFocus();\n    } else if (lastDeletedRectRef.current && focusOnDelete) {\n      // If something was deleted since the last update, focus on the\n      // next closest shape by center coordinates\n      const getShapeCenter = (shape: Rectangle) => ({\n        x: shape.x + shape.width / 2,\n        y: shape.y + shape.height / 2,\n      });\n      const deletedShapeCenter = getShapeCenter(lastDeletedRectRef.current);\n\n      let closestDistance = 2 ** 53 - 1;\n      let closestShapeActions: ShapeActions | null = null;\n      wrappedShapeActionRefsRef.current.forEach((shapeActionRef) => {\n        const shapeCenter = getShapeCenter(shapeActionRef.current.props);\n        const distance =\n          (deletedShapeCenter.x - shapeCenter.x) ** 2 +\n          (deletedShapeCenter.y - shapeCenter.y) ** 2;\n        if (distance < closestDistance) {\n          closestDistance = distance;\n          closestShapeActions = shapeActionRef.current;\n        }\n      });\n\n      if (closestShapeActions !== null) {\n        (closestShapeActions as ShapeActions).forceFocus();\n      }\n    }\n\n    justAddedShapeActionRefsRef.current = [];\n    lastDeletedRectRef.current = null;\n  });\n\n  const editorMountedRef = useIsMountedRef();\n\n  const onShapeMountedOrUnmounted = (\n    shapeActionsRef: React.MutableRefObject<ShapeActions>,\n    didMount: boolean\n  ) => {\n    if (didMount) {\n      // Only monitor shapes added after the initial editor render\n      if (editorMountedRef.current) {\n        justAddedShapeActionRefsRef.current = [\n          ...justAddedShapeActionRefsRef.current,\n          shapeActionsRef,\n        ];\n      }\n\n      wrappedShapeActionRefsRef.current = [\n        ...wrappedShapeActionRefsRef.current,\n        shapeActionsRef,\n      ];\n    } else {\n      const { x, y, width, height } = shapeActionsRef.current.props;\n      lastDeletedRectRef.current = { x, y, width, height };\n      wrappedShapeActionRefsRef.current = wrappedShapeActionRefsRef.current.filter(\n        (s) => s !== shapeActionsRef\n      );\n    }\n  };\n\n  return onShapeMountedOrUnmounted;\n};\n\nconst propTypes = {\n  children: PropTypes.node.isRequired,\n  focusOnAdd: PropTypes.bool,\n  focusOnDelete: PropTypes.bool,\n  padding: PropTypes.oneOfType([\n    PropTypes.number,\n    PropTypes.shape({\n      top: PropTypes.oneOfType([\n        PropTypes.number.isRequired,\n        PropTypes.oneOf([undefined]),\n      ]).isRequired,\n      right: PropTypes.oneOfType([\n        PropTypes.number.isRequired,\n        PropTypes.oneOf([undefined]),\n      ]).isRequired,\n      bottom: PropTypes.oneOfType([\n        PropTypes.number.isRequired,\n        PropTypes.oneOf([undefined]),\n      ]).isRequired,\n      left: PropTypes.oneOfType([\n        PropTypes.number.isRequired,\n        PropTypes.oneOf([undefined]),\n      ]).isRequired,\n    }),\n  ]),\n  scale: PropTypes.number,\n  style: PropTypes.shape({}),\n  vectorHeight: PropTypes.number.isRequired,\n  vectorWidth: PropTypes.number.isRequired,\n};\n\nconst ShapeEditor = React.forwardRef<SVGSVGElement | null, ShapeEditorProps>(\n  (\n    {\n      children,\n      focusOnAdd = true,\n      focusOnDelete = true,\n      scale = 1,\n      style = {},\n      vectorHeight,\n      vectorWidth,\n      padding = 0,\n      ...otherProps\n    },\n    forwardedRef\n  ) => {\n    const {\n      top: paddingTop,\n      right: paddingRight,\n      bottom: paddingBottom,\n      left: paddingLeft,\n    } =\n      typeof padding === 'number'\n        ? {\n            top: padding,\n            right: padding,\n            bottom: padding,\n            left: padding,\n          }\n        : {\n            top: 0,\n            right: 0,\n            bottom: 0,\n            left: 0,\n            ...padding,\n          };\n\n    const svgElRef = useRef<SVGSVGElement>(null);\n    useImperativeHandle(forwardedRef, () => svgElRef.current as SVGSVGElement);\n\n    const getVectorCoordinatesFromMouseEventRef: CoordinateGetterType = useUpdatingRef(\n      (\n        event: MouseEvent | React.MouseEvent,\n        { x: offsetX = 0, y: offsetY = 0 } = {}\n      ): Point => {\n        if (!svgElRef.current) {\n          return { x: 0, y: 0 };\n        }\n\n        const { top, left } = svgElRef.current.getBoundingClientRect();\n\n        return {\n          x: (event.clientX - left - paddingLeft) / scale - offsetX,\n          y: (event.clientY - top - paddingTop) / scale - offsetY,\n        };\n      }\n    );\n\n    const onShapeMountedOrUnmounted = useChildAddDeleteHandler(\n      focusOnAdd,\n      focusOnDelete\n    );\n\n    const eventEmitter = useNewEventEmitter();\n    useMouseEventForwarding(eventEmitter);\n    useAdditionalListener(\n      eventEmitter,\n      EventType.MountedOrUnmounted,\n      onShapeMountedOrUnmounted\n    );\n\n    const vectorPaddingTop = paddingTop / scale;\n    const vectorPaddingRight = paddingRight / scale;\n    const vectorPaddingBottom = paddingBottom / scale;\n    const vectorPaddingLeft = paddingLeft / scale;\n\n    return (\n      <svg\n        className=\"rse-plane-container\"\n        width={vectorWidth * scale + paddingLeft + paddingRight}\n        height={vectorHeight * scale + paddingTop + paddingBottom}\n        preserveAspectRatio=\"xMinYMin\"\n        viewBox={[\n          -vectorPaddingLeft,\n          -vectorPaddingTop,\n          vectorWidth + vectorPaddingLeft + vectorPaddingRight,\n          vectorHeight + vectorPaddingTop + vectorPaddingBottom,\n        ].join(' ')}\n        ref={svgElRef}\n        style={{\n          userSelect: 'none',\n          ...style,\n        }}\n        // IE11 - prevent all elements from being focusable by default\n        focusable=\"false\"\n        // eslint-disable-next-line react/jsx-props-no-spreading\n        {...otherProps}\n      >\n        <CoordinateGetterRefProvider\n          value={getVectorCoordinatesFromMouseEventRef}\n        >\n          <EventEmitterProvider value={eventEmitter}>\n            <DimensionsProvider\n              value={{\n                vectorWidth,\n                vectorHeight,\n                vectorPaddingTop,\n                vectorPaddingRight,\n                vectorPaddingBottom,\n                vectorPaddingLeft,\n                scale,\n              }}\n            >\n              {children}\n            </DimensionsProvider>\n          </EventEmitterProvider>\n        </CoordinateGetterRefProvider>\n      </svg>\n    );\n  }\n);\n\nShapeEditor.propTypes = propTypes;\n\nexport default ShapeEditor;\n","/* eslint-disable react/no-unused-prop-types */\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { HandleName, ResizeCursor, ResizeHandleComponentType } from './types';\n\nconst propTypes = {\n  active: PropTypes.bool.isRequired,\n  nativeActive: PropTypes.bool.isRequired,\n  cursor: PropTypes.oneOf([\n    'ns-resize',\n    'ew-resize',\n    'nesw-resize',\n    'nwse-resize',\n  ] as ResizeCursor[]).isRequired,\n  isBeingChanged: PropTypes.bool.isRequired,\n  isInSelectionGroup: PropTypes.bool.isRequired,\n  name: PropTypes.oneOf([\n    'w',\n    'n',\n    's',\n    'e',\n    'nw',\n    'ne',\n    'sw',\n    'se',\n  ] as HandleName[]).isRequired,\n  onMouseDown: PropTypes.func.isRequired,\n  recommendedSize: PropTypes.number.isRequired,\n  scale: PropTypes.number.isRequired,\n  x: PropTypes.number.isRequired,\n  y: PropTypes.number.isRequired,\n};\n\nconst DefaultResizeHandleComponent: ResizeHandleComponentType = ({\n  active,\n  cursor,\n  isInSelectionGroup,\n  onMouseDown,\n  recommendedSize,\n  scale,\n  x,\n  y,\n}) => (\n  <rect\n    fill={active ? 'rgba(229,240,244,1)' : 'rgba(229,240,244,0.3)'}\n    height={recommendedSize}\n    stroke={active ? 'rgba(53,33,140,1)' : 'rgba(53,33,140,0.3)'}\n    strokeWidth={1 / scale}\n    style={{ cursor, opacity: isInSelectionGroup ? 0 : 1 }}\n    width={recommendedSize}\n    x={x - recommendedSize / 2}\n    y={y - recommendedSize / 2}\n    // The onMouseDown prop must be passed on or resize will not work\n    onMouseDown={onMouseDown}\n  />\n);\n\nDefaultResizeHandleComponent.propTypes = propTypes;\n\nexport default DefaultResizeHandleComponent;\n","import {\n  ConstrainMoveFunc,\n  ConstrainResizeFunc,\n  Point,\n  Rectangle,\n} from './types';\n\nexport function getRectFromCornerCoordinates(\n  corner1: Point,\n  corner2: Point\n): Rectangle {\n  return {\n    x: Math.min(corner1.x, corner2.x),\n    y: Math.min(corner1.y, corner2.y),\n    width: Math.abs(corner1.x - corner2.x),\n    height: Math.abs(corner1.y - corner2.y),\n  };\n}\n\nexport const getNonIntersectingElements = <T>(arr1: T[], arr2: T[]) => {\n  const set1 = new Set(arr1);\n  const set2 = new Set(arr2);\n  return [\n    ...arr1.filter((x) => !set2.has(x)),\n    ...arr2.filter((x) => !set1.has(x)),\n  ];\n};\n\nexport const defaultConstrainMove: ConstrainMoveFunc = ({ x, y }) => ({\n  x,\n  y,\n});\nexport const defaultConstrainResize: ConstrainResizeFunc = ({ movingCorner }) =>\n  movingCorner;\n\nexport const forceFocus = (element: SVGElement | null): void => {\n  if (!element) return;\n\n  if (typeof element.focus === 'function') {\n    element.focus();\n  } else {\n    // IE11 doesn't have the focus method, so we use this hack from\n    // https://allyjs.io/tutorials/focusing-in-svg.html#focusing-svg-elements\n    try {\n      HTMLElement.prototype.focus.apply(element);\n    } catch (error) {\n      // silence the error\n    }\n  }\n};\n\ndeclare global {\n  interface Document {\n    msElementsFromPoint:\n      | ((x: number, y: number) => Element[] | null)\n      | undefined;\n  }\n}\n\n/**\n * Returns elements underneath the specified x and y coordinates.\n * @param clientX\n * @param clientY\n */\nexport const getElementsFromPoint = (\n  clientX: number,\n  clientY: number\n): Element[] => {\n  return typeof document.msElementsFromPoint === 'function'\n    ? Array.prototype.slice.call(\n        // msElementsFromPoint returns null when there are no elements\n        // found\n        document.msElementsFromPoint(clientX, clientY) || []\n      )\n    : document.elementsFromPoint(clientX, clientY);\n};\n","import React, {\n  useRef,\n  useState,\n  useImperativeHandle,\n  useCallback,\n  useLayoutEffect,\n} from 'react';\nimport PropTypes from 'prop-types';\nimport DefaultResizeHandleComponent from './DefaultResizeHandleComponent';\nimport useRootContext from './useRootContext';\nimport {\n  getRectFromCornerCoordinates,\n  defaultConstrainMove,\n  defaultConstrainResize,\n  forceFocus,\n} from './utils';\nimport { useCancelModeOnEscapeKey, useUpdatingRef } from './hooks';\nimport { EventType, EventEmitter } from './EventEmitter';\nimport {\n  ConstrainMoveFunc,\n  ConstrainResizeFunc,\n  HandleName,\n  Point,\n  Rectangle,\n  ResizeCursor,\n  ShapeActions,\n  ShapeId,\n  WrappedShapeProps,\n  WrappedShapePropsInActions,\n  WrappedShapeReceivedProps,\n  GetSelectionChildUpdatedRect,\n  ResizeHandleComponentType,\n  CoordinateGetterType,\n  CornerHandleName,\n} from './types';\n\ntype Sides = {\n  top: number;\n  right: number;\n  bottom: number;\n  left: number;\n};\n\ntype DragLock = 'x' | 'y' | null;\n\ntype DragState = {\n  isMouseDown: boolean;\n  dragStartCoordinates: Point;\n  dragCurrentCoordinates: Point;\n  dragInnerOffset: Point;\n  dragLock: DragLock;\n  isDragToMove: boolean;\n};\ntype SetDragState = React.Dispatch<React.SetStateAction<DragState>>;\nconst defaultDragState: DragState = {\n  isMouseDown: false,\n  dragStartCoordinates: { x: 0, y: 0 },\n  dragCurrentCoordinates: { x: 0, y: 0 },\n  dragInnerOffset: { x: 0, y: 0 },\n  dragLock: null,\n  isDragToMove: true,\n};\n\nconst getHandles = (\n  ResizeHandleComponent: ResizeHandleComponentType,\n  sides: Sides,\n  scale: number,\n  active: boolean,\n  nativeActive: boolean,\n  isInSelectionGroup: boolean,\n  coordinateGetterRef: CoordinateGetterType,\n  requestMouseHandler: () => void,\n  setDragState: SetDragState,\n  isBeingChanged: boolean\n) => {\n  const currentWidth = sides.right - sides.left;\n  const currentHeight = sides.bottom - sides.top;\n\n  // The corner of the resize box that moves\n  const movementPoints = {\n    nw: { x: sides.left, y: sides.top },\n    sw: { x: sides.left, y: sides.bottom },\n    ne: { x: sides.right, y: sides.top },\n    se: { x: sides.right, y: sides.bottom },\n  };\n  // The corner of the resize box that stays static\n  const anchorPoints = {\n    nw: movementPoints.se,\n    sw: movementPoints.ne,\n    ne: movementPoints.sw,\n    se: movementPoints.nw,\n  };\n\n  const RECOMMENDED_CORNER_SIZE = 10;\n  const cornerSize = RECOMMENDED_CORNER_SIZE / scale;\n  const hasSpaciousVertical =\n    (sides.bottom - sides.top) * scale > RECOMMENDED_CORNER_SIZE * 2;\n  const hasSpaciousHorizontal =\n    (sides.right - sides.left) * scale > RECOMMENDED_CORNER_SIZE * 2;\n\n  const handlesInfo: [\n    handleName: HandleName,\n    movementReferenceCorner: CornerHandleName,\n    cursor: ResizeCursor,\n    x: number,\n    y: number,\n    dragLock: DragLock\n  ][] = [];\n  if (hasSpaciousVertical)\n    handlesInfo.push(['w', 'nw', 'ew-resize', 0, currentHeight / 2, 'y']);\n  if (hasSpaciousHorizontal)\n    handlesInfo.push(['n', 'ne', 'ns-resize', currentWidth / 2, 0, 'x']);\n  if (hasSpaciousHorizontal)\n    handlesInfo.push([\n      's',\n      'sw',\n      'ns-resize',\n      currentWidth / 2,\n      currentHeight,\n      'x',\n    ]);\n  if (hasSpaciousVertical)\n    handlesInfo.push([\n      'e',\n      'se',\n      'ew-resize',\n      currentWidth,\n      currentHeight / 2,\n      'y',\n    ]);\n  handlesInfo.push(\n    ['nw', 'nw', 'nwse-resize', 0, 0, null],\n    ['ne', 'ne', 'nesw-resize', currentWidth, 0, null],\n    ['sw', 'sw', 'nesw-resize', 0, currentHeight, null],\n    ['se', 'se', 'nwse-resize', currentWidth, currentHeight, null]\n  );\n  const handles = handlesInfo.map(\n    ([handleName, movementReferenceCorner, cursor, x, y, dragLock]) => (\n      <ResizeHandleComponent\n        key={handleName}\n        active={active}\n        nativeActive={nativeActive}\n        cursor={cursor}\n        isBeingChanged={isBeingChanged}\n        isInSelectionGroup={isInSelectionGroup}\n        name={handleName}\n        onMouseDown={(event: React.MouseEvent) => {\n          // Ignore anything but left clicks\n          if (event.buttons !== 1) return;\n\n          event.stopPropagation();\n\n          const { x: planeX, y: planeY } = coordinateGetterRef.current(event);\n\n          const movingPoint = movementPoints[movementReferenceCorner];\n          const anchorPoint = anchorPoints[movementReferenceCorner];\n          const nextDragInnerOffset = {\n            x: planeX - movingPoint.x,\n            y: planeY - movingPoint.y,\n          };\n\n          requestMouseHandler();\n\n          setDragState({\n            isMouseDown: true,\n            dragStartCoordinates: anchorPoint,\n            dragCurrentCoordinates: movingPoint,\n            dragInnerOffset: nextDragInnerOffset,\n            dragLock,\n            isDragToMove: false,\n          });\n        }}\n        recommendedSize={cornerSize}\n        scale={scale}\n        x={x}\n        y={y}\n      />\n    )\n  );\n\n  return handles;\n};\n\nconst useNotifyRoot = (\n  eventEmitter: EventEmitter,\n  height: number,\n  width: number,\n  x: number,\n  y: number,\n  shapeId: ShapeId,\n  isInternalComponent: boolean,\n  shapeActions: ShapeActions\n) => {\n  // Notify of shape rectangle changes\n  useLayoutEffect(() => {\n    eventEmitter.emit(EventType.ChildRectChanged, shapeId, isInternalComponent);\n  }, [height, width, x, y, shapeId, isInternalComponent, eventEmitter]);\n\n  // Notify of mount/unmount\n  const shapeActionsRef = useUpdatingRef(shapeActions);\n  useLayoutEffect(() => {\n    if (!isInternalComponent) {\n      eventEmitter.emit(EventType.MountedOrUnmounted, shapeActionsRef, true);\n    }\n\n    return () => {\n      if (!isInternalComponent) {\n        eventEmitter.emit(EventType.MountedOrUnmounted, shapeActionsRef, false);\n      }\n    };\n  }, [shapeActionsRef, isInternalComponent, eventEmitter]);\n};\n\nconst getNextRectOfSelectionChild = (\n  selectionStartRect: Rectangle,\n  selectionEndRect: Rectangle,\n  childRect: Rectangle\n): Rectangle => {\n  const scaleX =\n    selectionStartRect.width !== 0\n      ? selectionEndRect.width / selectionStartRect.width\n      : 0;\n  const scaleY =\n    selectionStartRect.height !== 0\n      ? selectionEndRect.height / selectionStartRect.height\n      : 0;\n\n  return {\n    x: selectionEndRect.x + (childRect.x - selectionStartRect.x) * scaleX,\n    y: selectionEndRect.y + (childRect.y - selectionStartRect.y) * scaleY,\n    width: scaleX !== 0 ? childRect.width * scaleX : selectionEndRect.width,\n    height: scaleY !== 0 ? childRect.height * scaleY : selectionEndRect.height,\n  };\n};\n\nconst createSelectionChildRectConstrainedGetter = (\n  childRect: Rectangle,\n  constrainMove: ConstrainMoveFunc,\n  constrainResize: ConstrainResizeFunc,\n  vectorHeight: number,\n  vectorWidth: number\n) => (selectionStartRect: Rectangle, selectionEndRect: Rectangle) => {\n  const {\n    x: adjustedX,\n    y: adjustedY,\n    width: adjustedWidth,\n    height: adjustedHeight,\n  } = getNextRectOfSelectionChild(\n    selectionStartRect,\n    selectionEndRect,\n    childRect\n  );\n\n  const { x, y } = constrainMove({\n    originalX: childRect.x,\n    originalY: childRect.y,\n    x: adjustedX,\n    y: adjustedY,\n    width: adjustedWidth,\n    height: adjustedHeight,\n    vectorHeight,\n    vectorWidth,\n  });\n\n  const { x: right, y: bottom } = constrainResize({\n    originalMovingCorner: {\n      x: x + childRect.width,\n      y: y + childRect.height,\n    },\n    startCorner: { x, y },\n    movingCorner: {\n      x: x + adjustedWidth,\n      y: y + adjustedHeight,\n    },\n    lockedDimension: null,\n    vectorHeight,\n    vectorWidth,\n  });\n  return { x, y, width: right - x, height: bottom - y };\n};\n\nconst useShapeActions = (\n  forwardedRef:\n    | ((instance: ShapeActions | null) => void)\n    | React.RefObject<ShapeActions>\n    | null\n    | undefined,\n  props: WrappedShapePropsInActions,\n  forceFocusCb: () => void,\n  getSelectionChildUpdatedRect: GetSelectionChildUpdatedRect,\n  setDragState: SetDragState\n): ShapeActions => {\n  const shapeActions = {\n    props,\n    forceFocus: forceFocusCb,\n    getSelectionChildUpdatedRect,\n    simulateTransform(nextRect: Rectangle | null) {\n      if (!nextRect) {\n        setDragState(defaultDragState);\n        return;\n      }\n\n      setDragState((lastDragState) => ({\n        ...lastDragState,\n        isMouseDown: true,\n        dragStartCoordinates: { x: nextRect.x, y: nextRect.y },\n        dragCurrentCoordinates: {\n          x: nextRect.x + nextRect.width,\n          y: nextRect.y + nextRect.height,\n        },\n      }));\n    },\n  };\n\n  useImperativeHandle(forwardedRef, () => shapeActions, [\n    props,\n    forceFocusCb,\n    setDragState,\n  ]);\n\n  return shapeActions;\n};\n\nconst useMouseHandlerRef = (\n  props: WrappedShapePropsInActions,\n  constrainMove: ConstrainMoveFunc,\n  constrainResize: ConstrainResizeFunc,\n  coordinateGetterRef: CoordinateGetterType,\n  dragCurrentCoordinates: Point,\n  dragInnerOffset: Point,\n  dragLock: DragLock,\n  dragStartCoordinates: Point,\n  eventEmitter: EventEmitter,\n  isDragToMove: boolean,\n  isMouseDown: boolean,\n  onChange: (\n    nextRect: Rectangle,\n    shapeProps: WrappedShapePropsInActions\n  ) => void,\n  onIntermediateChange: (intermediateRect: Rectangle) => void,\n  setDragState: SetDragState,\n  vectorHeight: number,\n  vectorWidth: number\n) => {\n  const { height, width, x, y } = props;\n\n  const onMouseMove = (event: MouseEvent) => {\n    if (!isMouseDown) return;\n\n    if (isDragToMove) {\n      const { x: rawX, y: rawY } = coordinateGetterRef.current(\n        event,\n        dragInnerOffset\n      );\n\n      const coords = constrainMove({\n        originalX: dragCurrentCoordinates.x,\n        originalY: dragCurrentCoordinates.y,\n        x: rawX,\n        y: rawY,\n        width,\n        height,\n        vectorHeight,\n        vectorWidth,\n      });\n\n      const right = coords.x + width;\n      const bottom = coords.y + height;\n\n      setDragState((prevState) => ({\n        ...prevState,\n        dragCurrentCoordinates: coords,\n        dragStartCoordinates: { x: right, y: bottom },\n      }));\n\n      onIntermediateChange({\n        x: coords.x,\n        y: coords.y,\n        width,\n        height,\n      });\n    } else {\n      const { x: rawX, y: rawY } = coordinateGetterRef.current(\n        event,\n        dragInnerOffset\n      );\n\n      const { x: nextX, y: nextY } = constrainResize({\n        originalMovingCorner: dragCurrentCoordinates,\n        startCorner: dragStartCoordinates,\n        movingCorner: { x: rawX, y: rawY },\n        lockedDimension: dragLock,\n        vectorHeight,\n        vectorWidth,\n      });\n\n      const coords = {\n        x: dragLock !== 'x' ? nextX : dragCurrentCoordinates.x,\n        y: dragLock !== 'y' ? nextY : dragCurrentCoordinates.y,\n      };\n      setDragState((prevState) => ({\n        ...prevState,\n        dragCurrentCoordinates: coords,\n      }));\n\n      onIntermediateChange(\n        getRectFromCornerCoordinates(coords, dragStartCoordinates)\n      );\n    }\n  };\n\n  const onMouseUp = () => {\n    if (!isMouseDown) {\n      return;\n    }\n\n    if (isDragToMove) {\n      const { x: nextX, y: nextY } = dragCurrentCoordinates;\n\n      setDragState(defaultDragState);\n      if (nextX !== x || nextY !== y) {\n        onChange({ x: nextX, y: nextY, width, height }, props);\n      }\n    } else {\n      setDragState(defaultDragState);\n      const nextRect = getRectFromCornerCoordinates(\n        dragStartCoordinates,\n        dragCurrentCoordinates\n      );\n\n      if (\n        nextRect.height !== height ||\n        nextRect.width !== width ||\n        nextRect.x !== x ||\n        nextRect.y !== y\n      ) {\n        onChange(nextRect, props);\n      }\n    }\n  };\n\n  const mouseHandlerRef = useUpdatingRef((event: MouseEvent) => {\n    if (event.type === 'mousemove') {\n      onMouseMove(event);\n    } else if (event.type === 'mouseup') {\n      onMouseUp();\n    }\n  });\n\n  return () => {\n    eventEmitter.overwriteAllListenersOfType(\n      EventType.MouseEvent,\n      mouseHandlerRef\n    );\n  };\n};\n\nconst useOnKeyDown = (\n  props: WrappedShapePropsInActions,\n  constrainMove: ConstrainMoveFunc,\n  constrainResize: ConstrainResizeFunc,\n  height: number,\n  keyboardTransformMultiplier: number,\n  onChange: (\n    nextRect: Rectangle,\n    shapeProps: WrappedShapePropsInActions\n  ) => void,\n  onDelete: (\n    event: React.KeyboardEvent,\n    shapeProps: WrappedShapePropsInActions\n  ) => void,\n  onKeyDown: (\n    event: React.KeyboardEvent,\n    shapeProps: WrappedShapePropsInActions\n  ) => void,\n  vectorHeight: number,\n  vectorWidth: number,\n  width: number,\n  x: number,\n  y: number\n) => {\n  const keyboardMove = (dX: number, dY: number) => {\n    const { x: nextX, y: nextY } = constrainMove({\n      originalX: x,\n      originalY: y,\n      x: x + dX * keyboardTransformMultiplier,\n      y: y + dY * keyboardTransformMultiplier,\n      width,\n      height,\n      vectorHeight,\n      vectorWidth,\n    });\n\n    onChange({ x: nextX, y: nextY, width, height }, props);\n  };\n\n  const keyboardResize = (dX: number, dY: number) => {\n    const { x: nextX, y: nextY } = constrainResize({\n      originalMovingCorner: {\n        x: x + width,\n        y: y + height,\n      },\n      startCorner: { x, y },\n      movingCorner: {\n        x: x + width + dX * keyboardTransformMultiplier,\n        y: y + height + dY * keyboardTransformMultiplier,\n      },\n      lockedDimension: null,\n      vectorHeight,\n      vectorWidth,\n    });\n\n    onChange(\n      getRectFromCornerCoordinates({ x, y }, { x: nextX, y: nextY }),\n      props\n    );\n  };\n\n  return (event: React.KeyboardEvent) => {\n    // User-defined callback\n    onKeyDown(event, props);\n\n    // If the user-defined callback called event.preventDefault(),\n    // we consider the event handled\n    if (event.defaultPrevented) return;\n\n    let handled = true;\n    type KeyArgs = [number, number];\n    const handleKeyboardTransform = (moveArgs: KeyArgs, resizeArgs: KeyArgs) =>\n      event.shiftKey\n        ? keyboardResize(...resizeArgs)\n        : keyboardMove(...moveArgs);\n    switch (event.key) {\n      case 'Backspace':\n      case 'Delete':\n        onDelete(event, props);\n        break;\n      case 'ArrowUp':\n        handleKeyboardTransform([0, -1], [0, -1]);\n        break;\n      case 'ArrowRight':\n        handleKeyboardTransform([1, 0], [1, 0]);\n        break;\n      case 'ArrowDown':\n        handleKeyboardTransform([0, 1], [0, 1]);\n        break;\n      case 'ArrowLeft':\n        handleKeyboardTransform([-1, 0], [-1, 0]);\n        break;\n      default:\n        handled = false;\n    }\n\n    if (handled) {\n      event.preventDefault();\n    }\n  };\n};\n\nfunction wrapShape(\n  WrappedComponent: React.ComponentType<WrappedShapeReceivedProps>\n) {\n  const propTypes = {\n    active: PropTypes.bool,\n    constrainMove: PropTypes.func,\n    constrainResize: PropTypes.func,\n    disabled: PropTypes.bool,\n    height: PropTypes.number.isRequired,\n    isInSelectionGroup: PropTypes.bool,\n    isInternalComponent: PropTypes.bool,\n    keyboardTransformMultiplier: PropTypes.number,\n    onBlur: PropTypes.func,\n    onChange: PropTypes.func,\n    onDelete: PropTypes.func,\n    onFocus: PropTypes.func,\n    onKeyDown: PropTypes.func,\n    onIntermediateChange: PropTypes.func,\n    ResizeHandleComponent: PropTypes.func,\n    shapeId: PropTypes.string.isRequired,\n    width: PropTypes.number.isRequired,\n    wrapperProps: PropTypes.shape({}),\n    x: PropTypes.number.isRequired,\n    y: PropTypes.number.isRequired,\n  };\n\n  const WrappedShape = React.forwardRef<ShapeActions, WrappedShapeProps>(\n    (\n      {\n        // props extracted here are not passed to child\n        constrainMove = defaultConstrainMove,\n        constrainResize = defaultConstrainResize,\n        isInternalComponent = false,\n        keyboardTransformMultiplier = 1,\n        onBlur = () => {},\n        onChange = () => {},\n        onDelete = () => {},\n        onFocus = () => {},\n        onIntermediateChange = () => {},\n        onKeyDown = () => {},\n        ResizeHandleComponent = DefaultResizeHandleComponent,\n        wrapperProps = {},\n        ...otherMainProps\n      },\n      forwardedRef\n    ) => {\n      const [nativeActive, setNativeActive] = useState(false);\n\n      const props: WrappedShapePropsInActions = {\n        disabled: false,\n        isInSelectionGroup: false,\n        ...otherMainProps,\n        active:\n          otherMainProps.active !== undefined\n            ? otherMainProps.active\n            : nativeActive,\n        extraShapeProps: otherMainProps.extraShapeProps || {},\n      };\n      const {\n        // props extracted here are still passed to the child\n        active,\n        disabled,\n        isInSelectionGroup,\n        shapeId,\n        height,\n        width,\n        x,\n        y,\n      } = props;\n\n      const {\n        dimensions: { scale, vectorHeight, vectorWidth },\n        coordinateGetterRef,\n        eventEmitter,\n      } = useRootContext();\n\n      const wrapperElRef = useRef<SVGGElement>(null);\n\n      const [\n        {\n          isMouseDown,\n          dragStartCoordinates,\n          dragCurrentCoordinates,\n          dragInnerOffset,\n          dragLock,\n          isDragToMove,\n        },\n        setDragState,\n      ] = useState(defaultDragState);\n\n      useCancelModeOnEscapeKey(isMouseDown, () =>\n        setDragState(defaultDragState)\n      );\n\n      const forceFocusCb = useCallback(() => {\n        // Force focus if it's not already focused\n        if (!nativeActive) {\n          forceFocus(wrapperElRef.current);\n        }\n      }, [nativeActive, wrapperElRef]);\n      const getSelectionChildUpdatedRect = useCallback(\n        createSelectionChildRectConstrainedGetter(\n          { x, y, height, width },\n          constrainMove,\n          constrainResize,\n          vectorHeight,\n          vectorWidth\n        ),\n        [\n          x,\n          y,\n          width,\n          height,\n          constrainMove,\n          constrainResize,\n          vectorWidth,\n          vectorHeight,\n        ]\n      );\n      const shapeActions = useShapeActions(\n        forwardedRef,\n        props,\n        forceFocusCb,\n        getSelectionChildUpdatedRect,\n        setDragState\n      );\n\n      useNotifyRoot(\n        eventEmitter,\n        height,\n        width,\n        x,\n        y,\n        shapeId,\n        isInternalComponent,\n        shapeActions\n      );\n\n      const sides = !isMouseDown\n        ? {\n            left: x,\n            right: x + width,\n            top: y,\n            bottom: y + height,\n          }\n        : {\n            left: Math.min(dragStartCoordinates.x, dragCurrentCoordinates.x),\n            right: Math.max(dragStartCoordinates.x, dragCurrentCoordinates.x),\n            top: Math.min(dragStartCoordinates.y, dragCurrentCoordinates.y),\n            bottom: Math.max(dragStartCoordinates.y, dragCurrentCoordinates.y),\n          };\n\n      const currentWidth = sides.right - sides.left;\n      const currentHeight = sides.bottom - sides.top;\n\n      const requestMouseHandler = useMouseHandlerRef(\n        props,\n        constrainMove,\n        constrainResize,\n        coordinateGetterRef,\n        dragCurrentCoordinates,\n        dragInnerOffset,\n        dragLock,\n        dragStartCoordinates,\n        eventEmitter,\n        isDragToMove,\n        isMouseDown,\n        onChange,\n        onIntermediateChange,\n        setDragState,\n        vectorHeight,\n        vectorWidth\n      );\n\n      // Generate drag handles\n      const handles = getHandles(\n        ResizeHandleComponent,\n        sides,\n        scale,\n        active,\n        nativeActive,\n        isInSelectionGroup,\n        coordinateGetterRef,\n        requestMouseHandler,\n        setDragState,\n        isMouseDown\n      );\n\n      const shapeOnKeyDown = useOnKeyDown(\n        props,\n        constrainMove,\n        constrainResize,\n        height,\n        keyboardTransformMultiplier,\n        onChange,\n        onDelete,\n        onKeyDown,\n        vectorHeight,\n        vectorWidth,\n        width,\n        x,\n        y\n      );\n      const gotFocusAfterClickRef = useRef(true);\n\n      return (\n        <g\n          data-shape-id={shapeId}\n          className=\"rse-shape-wrapper\"\n          transform={`translate(${sides.left},${sides.top})`}\n          style={{\n            cursor: 'move',\n            outline: 'none',\n            ...(disabled ? { pointerEvents: 'none' } : {}),\n          }}\n          ref={wrapperElRef}\n          focusable={!disabled ? 'true' : undefined} // IE11 support\n          tabIndex={!disabled ? 0 : undefined}\n          onFocus={(event) => {\n            gotFocusAfterClickRef.current = true;\n            eventEmitter.emit(\n              EventType.ChildFocus,\n              shapeId,\n              isInternalComponent\n            );\n            setNativeActive(true);\n\n            // Call user-defined focus handler\n            onFocus(event, props);\n          }}\n          onBlur={(event) => {\n            setNativeActive(false);\n            onBlur(event, props);\n          }}\n          onMouseUp={() => {\n            // Focusing support for Safari\n            // Safari (12) does not currently allow focusing via mouse events,\n            // even on elements with tabIndex=\"0\" (tabbing with the keyboard\n            // does work, however). This logic waits to see if focus was called\n            // following a click, and forces the focused state if necessary.\n            if (!gotFocusAfterClickRef.current) {\n              shapeActions.forceFocus();\n            }\n          }}\n          onMouseDown={(event) => {\n            // Ignore anything but left clicks\n            if (event.buttons !== 1) return;\n\n            event.stopPropagation();\n\n            if (event.shiftKey) {\n              eventEmitter.emit(\n                EventType.ChildToggleSelection,\n                shapeId,\n                isInternalComponent,\n                event\n              );\n\n              // Prevent default to keep this from triggering blur/focus events\n              // on the elements involved, which would otherwise cause a wave\n              // of event listener callbacks that are not needed.\n              event.preventDefault();\n              return;\n            }\n\n            gotFocusAfterClickRef.current = false;\n\n            const { x: planeX, y: planeY } = coordinateGetterRef.current(event);\n\n            requestMouseHandler();\n\n            setDragState((prevState) => ({\n              ...prevState,\n              isMouseDown: true,\n              dragCurrentCoordinates: { x, y },\n              dragStartCoordinates: {\n                x: x + currentWidth,\n                y: y + currentHeight,\n              },\n              dragInnerOffset: {\n                x: planeX - x,\n                y: planeY - y,\n              },\n              isDragToMove: true,\n            }));\n          }}\n          onKeyDown={shapeOnKeyDown}\n          // eslint-disable-next-line react/jsx-props-no-spreading\n          {...wrapperProps}\n        >\n          <WrappedComponent\n            isBeingChanged={isMouseDown}\n            nativeActive={nativeActive}\n            scale={scale}\n            // eslint-disable-next-line react/jsx-props-no-spreading\n            {...props}\n            width={currentWidth}\n            height={currentHeight}\n          />\n          {!disabled && handles}\n        </g>\n      );\n    }\n  );\n\n  WrappedShape.propTypes = propTypes;\n\n  WrappedShape.displayName = `wrapShape(${\n    WrappedComponent.displayName || WrappedComponent.name || 'Component'\n  })`;\n\n  return React.memo(WrappedShape);\n}\n\nexport default wrapShape;\n","import React, { useState, FunctionComponent, useEffect, useRef } from 'react';\nimport PropTypes from 'prop-types';\n\ninterface ImageDimensions {\n  readonly naturalHeight: number;\n  readonly naturalWidth: number;\n}\n\ntype ImageLoadCallback = (dimensions: ImageDimensions) => void;\n\nconst useImageLoader = (\n  imageSrc: string,\n  onLoad: ImageLoadCallback\n): ImageDimensions => {\n  const [{ naturalHeight, naturalWidth }, setDimensions] = useState({\n    naturalHeight: 0,\n    naturalWidth: 0,\n  });\n\n  // Use a ref so it only re-runs the image load effect when the source changes\n  const onLoadRef = useRef(onLoad);\n\n  useEffect(() => {\n    let didCancel = false;\n    // Load the background image in memory to measure its dimensions\n    const memoryImage = new Image();\n\n    memoryImage.onload = () => {\n      if (didCancel) {\n        return;\n      }\n\n      setDimensions({\n        naturalWidth: memoryImage.naturalWidth,\n        naturalHeight: memoryImage.naturalHeight,\n      });\n      onLoadRef.current({\n        naturalWidth: memoryImage.naturalWidth,\n        naturalHeight: memoryImage.naturalHeight,\n      });\n    };\n    memoryImage.src = imageSrc;\n\n    return () => {\n      didCancel = true;\n    };\n  }, [imageSrc, onLoadRef]);\n\n  return { naturalHeight, naturalWidth };\n};\n\ninterface Props {\n  onLoad?: ImageLoadCallback;\n  src: string;\n}\nconst propTypes = {\n  onLoad: PropTypes.func,\n  src: PropTypes.string.isRequired,\n};\n\nconst ImageLayer: FunctionComponent<Props> = ({\n  onLoad = () => {},\n  src,\n  ...otherProps\n}) => {\n  const { naturalHeight, naturalWidth } = useImageLoader(src, onLoad);\n\n  return (\n    <image\n      href={src}\n      width={naturalWidth}\n      height={naturalHeight}\n      // eslint-disable-next-line react/jsx-props-no-spreading\n      {...otherProps}\n    />\n  );\n};\n\nImageLayer.propTypes = propTypes;\n\nexport default ImageLayer;\n","import React from 'react';\nimport wrapShape from './wrapShape';\n\nconst DefaultDrawPreviewComponent = wrapShape(({ height, width }) => (\n  <rect fill=\"rgba(0,0,255,0.5)\" height={height} width={width} />\n));\n\nexport default DefaultDrawPreviewComponent;\n","import React, { useState } from 'react';\nimport PropTypes from 'prop-types';\nimport {\n  getRectFromCornerCoordinates,\n  defaultConstrainMove,\n  defaultConstrainResize,\n} from './utils';\nimport useRootContext from './useRootContext';\nimport DefaultDrawPreviewComponent from './DefaultDrawPreviewComponent';\nimport { Point, DrawLayerProps } from './types';\nimport { EventType } from './EventEmitter';\nimport { useCancelModeOnEscapeKey, useUpdatingRef } from './hooks';\n\ninterface DragState {\n  dragStartCoordinates: Point;\n  dragCurrentCoordinates: Point;\n  isMouseDown: boolean;\n}\n\nconst defaultPoint = { x: 0, y: 0 };\nconst defaultDragState: DragState = {\n  dragStartCoordinates: defaultPoint,\n  dragCurrentCoordinates: defaultPoint,\n  isMouseDown: false,\n};\n\nconst propTypes = {\n  constrainMove: PropTypes.func,\n  constrainResize: PropTypes.func,\n  DrawPreviewComponent: PropTypes.oneOfType([\n    PropTypes.func,\n    PropTypes.shape({}),\n  ]),\n  onAddShape: PropTypes.func.isRequired,\n  onDraw: PropTypes.func,\n  onDrawEnd: PropTypes.func,\n  onDrawStart: PropTypes.func,\n};\n\nconst noop = () => {};\n\nconst DrawLayer: React.FunctionComponent<DrawLayerProps> = ({\n  DrawPreviewComponent = DefaultDrawPreviewComponent,\n  constrainResize = defaultConstrainResize,\n  constrainMove = defaultConstrainMove,\n  onAddShape,\n  onDraw = noop,\n  onDrawEnd = noop,\n  onDrawStart = noop,\n}) => {\n  const {\n    dimensions: {\n      scale,\n      vectorHeight,\n      vectorPaddingBottom,\n      vectorPaddingLeft,\n      vectorPaddingRight,\n      vectorPaddingTop,\n      vectorWidth,\n    },\n    eventEmitter,\n    coordinateGetterRef,\n  } = useRootContext();\n\n  const [\n    { isMouseDown, dragStartCoordinates, dragCurrentCoordinates },\n    setDragState,\n  ] = useState(defaultDragState);\n\n  const getCoordinatesFromEvent = (\n    event: React.MouseEvent | MouseEvent,\n    isStartEvent = false\n  ) => {\n    const { x: rawX, y: rawY } = coordinateGetterRef.current(event);\n\n    if (isStartEvent) {\n      const { x, y } = constrainMove({\n        originalX: rawX,\n        originalY: rawY,\n        x: rawX,\n        y: rawY,\n        width: 0,\n        height: 0,\n        vectorWidth,\n        vectorHeight,\n      });\n\n      return { x, y };\n    }\n\n    const { x, y } = constrainResize({\n      originalMovingCorner: dragCurrentCoordinates,\n      startCorner: dragStartCoordinates,\n      movingCorner: { x: rawX, y: rawY },\n      lockedDimension: null,\n      vectorWidth,\n      vectorHeight,\n    });\n\n    return { x, y };\n  };\n\n  const endDragAndReset = (canceled = false) => {\n    setDragState(defaultDragState);\n\n    onDrawEnd({\n      startCorner: dragStartCoordinates,\n      movingCorner: dragCurrentCoordinates,\n      canceled,\n    });\n  };\n\n  const onMouseUp = () => {\n    if (!isMouseDown) {\n      return;\n    }\n\n    const newRect = getRectFromCornerCoordinates(\n      dragStartCoordinates,\n      dragCurrentCoordinates\n    );\n\n    endDragAndReset();\n\n    if (\n      dragStartCoordinates.x !== dragCurrentCoordinates.x &&\n      dragStartCoordinates.y !== dragCurrentCoordinates.y\n    ) {\n      onAddShape(newRect);\n    }\n  };\n\n  const onMouseMove = (event: MouseEvent) => {\n    if (!isMouseDown) {\n      return;\n    }\n\n    const currentCoordinates = getCoordinatesFromEvent(event);\n    setDragState((prevDragState) => ({\n      ...prevDragState,\n      dragCurrentCoordinates: currentCoordinates,\n    }));\n\n    onDraw({\n      startCorner: dragStartCoordinates,\n      movingCorner: currentCoordinates,\n    });\n  };\n\n  const mouseHandlerRef = useUpdatingRef((event: MouseEvent) => {\n    if (event.type === 'mousemove') {\n      onMouseMove(event);\n    } else if (event.type === 'mouseup') {\n      onMouseUp();\n    }\n  });\n\n  useCancelModeOnEscapeKey(isMouseDown, () => endDragAndReset(true));\n\n  const draggedRect = isMouseDown\n    ? getRectFromCornerCoordinates(dragStartCoordinates, dragCurrentCoordinates)\n    : null;\n\n  return (\n    <>\n      <rect\n        className=\"rse-draw-layer\"\n        x={-vectorPaddingLeft}\n        y={-vectorPaddingTop}\n        width={vectorWidth + vectorPaddingLeft + vectorPaddingRight}\n        height={vectorHeight + vectorPaddingTop + vectorPaddingBottom}\n        fill=\"transparent\"\n        onMouseDown={(event) => {\n          // Ignore anything but left clicks\n          if (event.buttons !== 1) return;\n\n          const startCoordinates = getCoordinatesFromEvent(event, true);\n          eventEmitter.overwriteAllListenersOfType(\n            EventType.MouseEvent,\n            mouseHandlerRef\n          );\n          setDragState({\n            dragStartCoordinates: startCoordinates,\n            dragCurrentCoordinates: startCoordinates,\n            isMouseDown: true,\n          });\n\n          onDrawStart({ startCorner: startCoordinates });\n        }}\n      />\n      {draggedRect && (\n        <DrawPreviewComponent\n          height={draggedRect.height}\n          disabled\n          isInternalComponent\n          scale={scale}\n          shapeId=\"rse-internal-draw-component\"\n          width={draggedRect.width}\n          x={draggedRect.x}\n          y={draggedRect.y}\n        />\n      )}\n    </>\n  );\n};\n\nDrawLayer.propTypes = propTypes;\n\nexport default DrawLayer;\n","import React from 'react';\nimport wrapShape from './wrapShape';\n\nconst DefaultSelectionDrawComponent = wrapShape(({ height, width }) => (\n  <rect fill=\"rgba(140,179,255,0.3)\" height={height} width={width} />\n));\n\nexport default DefaultSelectionDrawComponent;\n","import React from 'react';\nimport wrapShape from './wrapShape';\n\nconst DefaultSelectionComponent = wrapShape(({ height, scale, width }) => (\n  <rect\n    fill=\"transparent\"\n    stroke=\"rgba(140,179,255,1)\"\n    strokeWidth={2 / scale}\n    height={height}\n    width={width}\n  />\n));\n\nexport default DefaultSelectionComponent;\n","import React, { useLayoutEffect, useRef, useState } from 'react';\nimport PropTypes, { ReactNodeLike, ReactComponentLike } from 'prop-types';\nimport {\n  getRectFromCornerCoordinates,\n  getElementsFromPoint,\n  getNonIntersectingElements,\n} from './utils';\nimport useRootContext from './useRootContext';\nimport DefaultSelectionDrawComponent from './DefaultSelectionDrawComponent';\nimport DefaultSelectionComponent from './DefaultSelectionComponent';\nimport {\n  useCancelModeOnEscapeKey,\n  useForceUpdate,\n  useUpdatingRef,\n} from './hooks';\nimport { EventType, useAdditionalListener, EventEmitter } from './EventEmitter';\nimport {\n  Point,\n  ShapeId,\n  WrappedShapePropsInActions,\n  Rectangle,\n  ShapeActions,\n  CoordinateGetterType,\n  ShapeActionRefsDictRef,\n} from './types';\n\ntype DragState = {\n  dragStartCoordinates: Point;\n  dragCurrentCoordinates: Point;\n  isMouseDown: boolean;\n};\nconst defaultDragState: DragState = {\n  dragStartCoordinates: { x: 0, y: 0 },\n  dragCurrentCoordinates: { x: 0, y: 0 },\n  isMouseDown: false,\n};\n\nexport const SelectionContext = React.createContext(null);\n\nconst SELECTION_COMPONENT_SHAPE_ID = 'rse-internal-selection-component';\n\nconst getSelectionRect = (childRects: Rectangle[]) => {\n  const selectionX = Math.min(...childRects.map((c) => c.x));\n  const selectionY = Math.min(...childRects.map((c) => c.y));\n\n  return {\n    x: selectionX,\n    y: selectionY,\n    height: Math.max(...childRects.map((c) => c.y + c.height)) - selectionY,\n    width: Math.max(...childRects.map((c) => c.x + c.width)) - selectionX,\n  };\n};\n\nconst useMouseHandlerRef = (\n  isMouseDown: boolean,\n  dragStartCoordinates: Point,\n  dragCurrentCoordinates: Point,\n  prevSelectedShapeIds: string[],\n  setDragState: React.Dispatch<React.SetStateAction<DragState>>,\n  coordinateGetterRef: CoordinateGetterType,\n  selectionElRef: React.MutableRefObject<ShapeActions | null>,\n  onSelectionChange: (nextSelectedShapeIds: string[]) => void,\n  wrappedShapeActionRefsRef: ShapeActionRefsDictRef,\n  selectionIsLargeEnough: () => boolean\n) => {\n  const onMouseUp = () => {\n    if (!isMouseDown) return;\n\n    if (!selectionIsLargeEnough()) {\n      setDragState(defaultDragState);\n      return;\n    }\n\n    const selectRect = getRectFromCornerCoordinates(\n      dragStartCoordinates,\n      dragCurrentCoordinates\n    );\n    const justSelectedShapeIds = Object.keys(\n      wrappedShapeActionRefsRef.current\n    ).filter((shapeId) => {\n      const { x, y, width, height } = wrappedShapeActionRefsRef.current[\n        shapeId\n      ].current.props;\n\n      return (\n        x + width > selectRect.x &&\n        x < selectRect.x + selectRect.width &&\n        y + height > selectRect.y &&\n        y < selectRect.y + selectRect.height\n      );\n    });\n\n    // Add to the selection anything that was newly selected and not present\n    // in the existing selection, and remove from the selection anything that\n    // was newly selected and already present in the existing selection.\n    // Basically, we're toggling the selection state of the newly selected shapes\n    const nextSelectedShapeIds = getNonIntersectingElements(\n      justSelectedShapeIds,\n      prevSelectedShapeIds\n    );\n\n    setDragState(defaultDragState);\n\n    onSelectionChange(nextSelectedShapeIds);\n    if (nextSelectedShapeIds.length >= 2 && selectionElRef.current) {\n      // Focus on the group selection rect when it is first drawn\n      selectionElRef.current.forceFocus();\n    } else if (nextSelectedShapeIds.length === 1) {\n      // In the event that a single shape is selected, give native focus to it as well\n      wrappedShapeActionRefsRef.current[\n        nextSelectedShapeIds[0]\n      ].current.forceFocus();\n    }\n  };\n\n  const onMouseMove = (event: MouseEvent) => {\n    if (!isMouseDown) return;\n\n    setDragState((dragState) => ({\n      ...dragState,\n      dragCurrentCoordinates: coordinateGetterRef.current(event),\n    }));\n  };\n\n  const mouseHandlerRef = useUpdatingRef((event: MouseEvent) => {\n    if (event.type === 'mousemove') {\n      onMouseMove(event);\n    } else if (event.type === 'mouseup') {\n      onMouseUp();\n    }\n  });\n\n  return mouseHandlerRef;\n};\n\nconst useChildAddDeleteHandler = (\n  eventEmitter: EventEmitter,\n  onSelectionChange: (selectedShapeIds: ShapeId[]) => void,\n  selectedShapeIds: ShapeId[],\n  selectionElRef: React.MutableRefObject<ShapeActions | null>,\n  wrappedShapeActionRefsRef: ShapeActionRefsDictRef\n) => {\n  const selectedChildrenDidChangeRef = useRef(false);\n  const forceUpdate = useForceUpdate();\n\n  useLayoutEffect(() => {\n    if (selectedChildrenDidChangeRef.current) {\n      selectedChildrenDidChangeRef.current = false;\n\n      // Only force update if there is a selection.\n      // Otherwise, no change\n      if (selectedShapeIds.length >= 2) {\n        forceUpdate();\n      }\n    }\n  });\n\n  const onChildRectChanged = (\n    shapeId: ShapeId,\n    isInternalComponent: boolean\n  ) => {\n    if (isInternalComponent) return;\n\n    if (\n      !selectedChildrenDidChangeRef.current &&\n      selectedShapeIds.indexOf(shapeId) >= 0\n    ) {\n      selectedChildrenDidChangeRef.current = true;\n    }\n  };\n\n  const onShapeMountedOrUnmounted = (\n    shapeActionsRef: React.MutableRefObject<ShapeActions>,\n    didMount: boolean\n  ) => {\n    const { shapeId } = shapeActionsRef.current.props;\n    if (\n      !selectedChildrenDidChangeRef.current &&\n      selectedShapeIds.indexOf(shapeId) >= 0\n    ) {\n      selectedChildrenDidChangeRef.current = true;\n    }\n\n    if (didMount) {\n      // eslint-disable-next-line no-param-reassign\n      wrappedShapeActionRefsRef.current[shapeId] = shapeActionsRef;\n    } else {\n      // eslint-disable-next-line no-param-reassign\n      delete wrappedShapeActionRefsRef.current[shapeId];\n    }\n  };\n\n  const onChildToggleSelection = (\n    clickedShapeId: ShapeId,\n    isInternalComponent: boolean,\n    event: React.MouseEvent\n  ) => {\n    const isClickingSelection = clickedShapeId === SELECTION_COMPONENT_SHAPE_ID;\n    if (isInternalComponent && !isClickingSelection) return;\n\n    let targetShapeId = clickedShapeId;\n\n    // When trying to click shapes behind the selection rectangle, the\n    // selection rectangle absorbs the mouseDown event, so we have to\n    // use the position of the click to retrieve the element under the mouse.\n    if (isClickingSelection) {\n      const elementsUnderMouse = getElementsFromPoint(\n        event.clientX,\n        event.clientY\n      );\n\n      // Only the child elements (e.g., <rect>) of the wrapShape <g> tags\n      // get picked up by elementsFromPoint, so here we aim to access the\n      // <g> tags (which contain the shapeId) by getting the parentNode\n      // of each element found\n      for (let i = 0; i < elementsUnderMouse.length; i += 1) {\n        const parentNode = elementsUnderMouse[i].parentNode as\n          | SVGElement\n          | HTMLElement\n          | null;\n        if (!parentNode || !(parentNode instanceof SVGGElement)) {\n          // eslint-disable-next-line no-continue\n          continue;\n        }\n\n        // IE11-compatible way to get dataset info from SVG elements\n        let shapeId: string | null | undefined;\n        if (parentNode.dataset) {\n          ({ shapeId } = parentNode.dataset);\n        } else if (typeof parentNode.getAttribute === 'function') {\n          shapeId = parentNode.getAttribute('data-shape-id');\n        }\n\n        if (\n          typeof shapeId !== 'string' ||\n          shapeId === SELECTION_COMPONENT_SHAPE_ID\n        ) {\n          // eslint-disable-next-line no-continue\n          continue;\n        }\n\n        targetShapeId = shapeId;\n        break;\n      }\n    }\n\n    const isAdd = selectedShapeIds.indexOf(targetShapeId) < 0;\n    if (isAdd) {\n      const nextSelectedShapeIds = [...selectedShapeIds, targetShapeId];\n      onSelectionChange(nextSelectedShapeIds);\n\n      if (nextSelectedShapeIds.length >= 2) {\n        // Focus on the group selection rect when it is drawn\n        if (selectionElRef.current) {\n          selectionElRef.current.forceFocus();\n        } else {\n          setTimeout(() => {\n            if (selectionElRef.current) {\n              selectionElRef.current.forceFocus();\n            }\n          });\n        }\n      }\n    } else if (selectedShapeIds.length >= 2) {\n      // Only deselect when it is a group selection\n      onSelectionChange(selectedShapeIds.filter((id) => id !== targetShapeId));\n    }\n  };\n\n  const onChildFocus = (shapeId: ShapeId, isInternalComponent: boolean) => {\n    if (isInternalComponent) return;\n\n    if (\n      // We don't want to focus on the shape if it's already\n      // the only focused shape\n      selectedShapeIds.length !== 1 ||\n      selectedShapeIds[0] !== shapeId\n    ) {\n      onSelectionChange([shapeId]);\n    }\n  };\n\n  useAdditionalListener(\n    eventEmitter,\n    EventType.MountedOrUnmounted,\n    onShapeMountedOrUnmounted\n  );\n  useAdditionalListener(\n    eventEmitter,\n    EventType.ChildToggleSelection,\n    onChildToggleSelection\n  );\n  useAdditionalListener(\n    eventEmitter,\n    EventType.ChildRectChanged,\n    onChildRectChanged\n  );\n  useAdditionalListener(eventEmitter, EventType.ChildFocus, onChildFocus);\n};\n\nconst propTypes = {\n  children: PropTypes.node,\n  keyboardTransformMultiplier: PropTypes.number,\n  minimumDistanceForSelection: PropTypes.number,\n  onChange: PropTypes.func,\n  onDelete: PropTypes.func,\n  onSelectionChange: PropTypes.func.isRequired,\n  selectedShapeIds: PropTypes.arrayOf(PropTypes.string.isRequired).isRequired,\n  SelectionComponent: PropTypes.elementType,\n  selectionComponentProps: PropTypes.shape({}),\n  SelectionDrawComponent: PropTypes.elementType,\n};\ntype Props = {\n  children?: ReactNodeLike;\n  keyboardTransformMultiplier?: number;\n  minimumDistanceForSelection?: number;\n  onChange?: (\n    nextRects: Rectangle[],\n    changedShapesProps: WrappedShapePropsInActions[]\n  ) => void;\n  onDelete?: (\n    event: React.KeyboardEvent,\n    deletedShapesProps: WrappedShapePropsInActions[]\n  ) => void;\n  onSelectionChange: (selectedShapeIds: ShapeId[]) => void;\n  selectedShapeIds: ShapeId[];\n  SelectionComponent?: ReactComponentLike;\n  selectionComponentProps?: object;\n  SelectionDrawComponent?: ReactComponentLike;\n};\n\nconst SelectionLayer: React.FunctionComponent<Props> = ({\n  children = null,\n  keyboardTransformMultiplier = 1,\n  minimumDistanceForSelection = 15,\n  onChange = () => {},\n  onDelete = () => {},\n  onSelectionChange,\n  selectedShapeIds,\n  SelectionComponent = DefaultSelectionComponent,\n  selectionComponentProps = {},\n  SelectionDrawComponent = DefaultSelectionDrawComponent,\n}) => {\n  const [\n    { isMouseDown, dragStartCoordinates, dragCurrentCoordinates },\n    setDragState,\n  ] = useState(defaultDragState);\n  useCancelModeOnEscapeKey(isMouseDown, () => setDragState(defaultDragState));\n\n  const selectionIsLargeEnough = () => {\n    const selectionRect = getRectFromCornerCoordinates(\n      dragStartCoordinates,\n      dragCurrentCoordinates\n    );\n\n    return (\n      selectionRect.width >= minimumDistanceForSelection ||\n      selectionRect.height >= minimumDistanceForSelection\n    );\n  };\n\n  const {\n    dimensions: {\n      vectorHeight,\n      vectorPaddingBottom,\n      vectorPaddingLeft,\n      vectorPaddingRight,\n      vectorPaddingTop,\n      vectorWidth,\n    },\n    eventEmitter,\n    coordinateGetterRef,\n  } = useRootContext();\n\n  const selectionElRef = useRef<ShapeActions | null>(null);\n  const wrappedShapeActionRefsRef: ShapeActionRefsDictRef = useRef({});\n  useChildAddDeleteHandler(\n    eventEmitter,\n    onSelectionChange,\n    selectedShapeIds,\n    selectionElRef,\n    wrappedShapeActionRefsRef\n  );\n\n  const mouseHandlerRef = useMouseHandlerRef(\n    isMouseDown,\n    dragStartCoordinates,\n    dragCurrentCoordinates,\n    selectedShapeIds,\n    setDragState,\n    coordinateGetterRef,\n    selectionElRef,\n    onSelectionChange,\n    wrappedShapeActionRefsRef,\n    selectionIsLargeEnough\n  );\n\n  const selectedShapeActionRefs = selectedShapeIds\n    .map((shapeId) => wrappedShapeActionRefsRef.current[shapeId])\n    .filter(Boolean);\n  const simulatedTransformRef = useRef(0);\n  let selectionDrawComponent: JSX.Element | null = null;\n  if (isMouseDown) {\n    if (selectionIsLargeEnough()) {\n      const selectionRect = getRectFromCornerCoordinates(\n        dragStartCoordinates,\n        dragCurrentCoordinates\n      );\n      selectionDrawComponent = (\n        <SelectionDrawComponent\n          shapeId=\"rse-internal-selection-draw-component\"\n          disabled\n          height={selectionRect.height}\n          isInternalComponent\n          width={selectionRect.width}\n          x={selectionRect.x}\n          y={selectionRect.y}\n        />\n      );\n    }\n  }\n  let selectionComponent: JSX.Element | null = null;\n  if (selectedShapeActionRefs.length >= 2) {\n    const selectionRect = getSelectionRect(\n      selectedShapeActionRefs.map((s) => s.current.props)\n    );\n    selectionComponent = (\n      <SelectionComponent\n        keyboardTransformMultiplier={keyboardTransformMultiplier}\n        // eslint-disable-next-line react/jsx-props-no-spreading\n        {...selectionComponentProps}\n        shapeId={SELECTION_COMPONENT_SHAPE_ID}\n        isInternalComponent\n        ref={selectionElRef}\n        onIntermediateChange={(intermediateRect) => {\n          cancelAnimationFrame(simulatedTransformRef.current);\n          simulatedTransformRef.current = requestAnimationFrame(() => {\n            selectedShapeActionRefs.forEach((shapeActionRef) => {\n              const tempRect = shapeActionRef.current.getSelectionChildUpdatedRect(\n                selectionRect,\n                intermediateRect\n              );\n              shapeActionRef.current.simulateTransform(tempRect);\n            });\n          });\n        }}\n        onDelete={(event) => {\n          onDelete(\n            event,\n            selectedShapeActionRefs.map(\n              (shapeActionRef) => shapeActionRef.current.props\n            )\n          );\n        }}\n        onChange={(nextSelectionRect) => {\n          const nextRects = selectedShapeActionRefs.map((shapeActionRef) =>\n            shapeActionRef.current.getSelectionChildUpdatedRect(\n              selectionRect,\n              nextSelectionRect\n            )\n          );\n\n          // Restore the shapes back to their original positions\n          cancelAnimationFrame(simulatedTransformRef.current);\n          selectedShapeActionRefs.forEach((s) => {\n            s.current.simulateTransform(null);\n          });\n\n          onChange(\n            nextRects,\n            selectedShapeActionRefs.map((s) => s.current.props)\n          );\n        }}\n        height={selectionRect.height}\n        width={selectionRect.width}\n        x={selectionRect.x}\n        y={selectionRect.y}\n      />\n    );\n  }\n\n  return (\n    <g\n      onMouseDown={(event) => {\n        // Ignore anything but left clicks\n        if (event.buttons !== 1) return;\n\n        // Clear the selection if shift was not pressed\n        if (!event.shiftKey && selectedShapeIds.length > 0) {\n          onSelectionChange([]);\n        }\n      }}\n    >\n      <rect\n        className=\"rse-selection-layer\"\n        x={-vectorPaddingLeft}\n        y={-vectorPaddingTop}\n        width={vectorWidth + vectorPaddingLeft + vectorPaddingRight}\n        height={vectorHeight + vectorPaddingTop + vectorPaddingBottom}\n        fill=\"transparent\"\n        onMouseDown={(event) => {\n          // Ignore anything but left clicks\n          if (event.buttons !== 1) return;\n\n          const startCoordinates = coordinateGetterRef.current(event);\n          eventEmitter.overwriteAllListenersOfType(\n            EventType.MouseEvent,\n            mouseHandlerRef\n          );\n          setDragState({\n            dragStartCoordinates: startCoordinates,\n            dragCurrentCoordinates: startCoordinates,\n            isMouseDown: true,\n          });\n\n          // Clear the selection if shift was not pressed\n          if (!event.shiftKey && selectedShapeIds.length > 0) {\n            onSelectionChange([]);\n          }\n        }}\n      />\n\n      {children}\n      {selectionComponent}\n      {selectionDrawComponent}\n    </g>\n  );\n};\n\nSelectionLayer.propTypes = propTypes;\n\nexport default SelectionLayer;\n"],"names":["useRef","useEffect","useReducer","React","useContext","PropTypes","useState","useLayoutEffect","useImperativeHandle","propTypes","useCallback","defaultDragState","useMouseHandlerRef","useChildAddDeleteHandler"],"mappings":"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"}